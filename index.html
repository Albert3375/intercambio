<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÑ Intercambio Navide√±o üéÅ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #c62828;
            --primary-light: #ff5f52;
            --primary-dark: #8e0000;
            --secondary: #d32f2f;
            --accent: #c62828;
            --light: #ffffff;
            --dark: #333333;
            --gray: #f5f5f5;
            --gray-dark: #e0e0e0;
            --text: #212121;
            --text-light: #757575;
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
            --christmas-red: #c62828;
            --christmas-green: #2e7d32;
            --christmas-gold: #ffd54f;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light);
            color: var(--text);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 25px 0;
            text-align: center;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 4px 12px rgba(198, 40, 40, 0.3);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 10px;
            background: linear-gradient(90deg, 
                var(--christmas-green) 0%, 
                var(--christmas-green) 25%, 
                white 25%, 
                white 50%, 
                var(--christmas-gold) 50%, 
                var(--christmas-gold) 75%, 
                var(--christmas-red) 75%, 
                var(--christmas-red) 100%);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .header-decoration {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        .decoration-item {
            font-size: 1.5rem;
            animation: bounce 2s infinite ease-in-out;
        }
        
        .decoration-item:nth-child(2) {
            animation-delay: 0.3s;
        }
        
        .decoration-item:nth-child(3) {
            animation-delay: 0.6s;
        }
        
        /* Navigation */
        nav {
            background: white;
            border-radius: 10px;
            padding: 0;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .nav-container {
            display: flex;
            justify-content: center;
        }
        
        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            flex: 1;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: var(--text-light);
        }
        
        .nav-tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            background-color: rgba(198, 40, 40, 0.05);
        }
        
        .nav-tab:hover {
            background-color: rgba(198, 40, 40, 0.1);
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            border-left: 5px solid var(--primary);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .card-title {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gray-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
        }
        
        input[type="text"],
        input[type="email"],
        input[type="password"],
        textarea,
        select {
            width: 100%;
            padding: 14px;
            background: var(--gray);
            border: 1px solid var(--gray-dark);
            border-radius: 8px;
            font-size: 1rem;
            color: var(--text);
            transition: all 0.3s;
        }
        
        input:focus,
        textarea:focus,
        select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(198, 40, 40, 0.2);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, var(--primary-dark), #600);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(198, 40, 40, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--christmas-green), #1b5e20);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #1b5e20, #0d4010);
            box-shadow: 0 5px 15px rgba(46, 125, 50, 0.3);
        }
        
        .btn-accent {
            background: linear-gradient(135deg, var(--christmas-gold), #ffc107);
            color: var(--dark);
        }
        
        .btn-accent:hover {
            background: linear-gradient(135deg, #ffc107, #ffa000);
            box-shadow: 0 5px 15px rgba(255, 213, 79, 0.3);
        }
        
        /* Participants */
        .participants-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .participant-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            border: 1px solid var(--gray-dark);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }
        
        .participant-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--christmas-red), var(--christmas-green));
        }
        
        .participant-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }
        
        .participant-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--christmas-gold));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.8rem;
            color: white;
            border: 3px solid white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Results */
        .result-container {
            text-align: center;
            padding: 40px 30px;
            background: linear-gradient(135deg, #fff9f9, #fff);
            border-radius: 15px;
            margin-top: 20px;
            border: 2px dashed var(--primary);
            position: relative;
            overflow: hidden;
        }
        
        .result-container::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(198, 40, 40, 0.05) 0%, transparent 70%);
        }
        
        .result-name {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 20px 0;
            color: var(--primary);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .budget {
            background: var(--christmas-gold);
            color: var(--dark);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin: 15px 0;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        /* Alerts */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-success {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }
        
        .alert-error {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
        }
        
        .alert-warning {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid var(--warning);
            color: var(--warning);
        }
        
        /* Hidden utility */
        .hidden {
            display: none;
        }
        
        /* Admin section */
        .admin-section {
            background: linear-gradient(135deg, #fff9e6, #fff);
            border: 1px solid var(--christmas-gold);
        }
        
        /* Preferences */
        .preferences-form {
            background: linear-gradient(135deg, #f0f9ff, #fff);
            border: 1px solid #b3e5fc;
        }
        
        .preference-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .tag {
            background: var(--primary);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .tag i {
            cursor: pointer;
        }
        
        /* Share section */
        .share-section {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: rgba(198, 40, 40, 0.05);
            border-radius: 10px;
        }
        
        .share-btn {
            background: #25D366;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 5px;
        }
        
        .share-btn.whatsapp {
            background: #25D366;
        }
        
        .share-btn.facebook {
            background: #3b5998;
        }
        
        .share-btn.link {
            background: var(--primary);
        }
        
        /* Animations */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--text-light);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray-dark);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .participants-container {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }
            
            .nav-container {
                flex-direction: column;
            }
            
            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-gift"></i> Intercambio Navide√±o <i class="fas fa-tree"></i></h1>
            <p class="subtitle">Reg√≠strate y descubre a qui√©n te toca regalar en esta Navidad</p>
            <div class="header-decoration">
                <div class="decoration-item">üéÑ</div>
                <div class="decoration-item">üéÅ</div>
                <div class="decoration-item">‚≠ê</div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Navigation (visible despu√©s del login) -->
        <nav id="main-nav">
            <div class="nav-container">
                <div class="nav-tab active" data-tab="participants"><i class="fas fa-users"></i> Participantes</div>
                <div class="nav-tab" data-tab="preferences"><i class="fas fa-heart"></i> Mis Preferencias</div>
                <div class="nav-tab" data-tab="result"><i class="fas fa-gift"></i> Mi Pareja</div>
                <div class="nav-tab" data-tab="admin" id="admin-tab"><i class="fas fa-crown"></i> Administrar</div>
                <div class="nav-tab" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n</div>
            </div>
        </nav>

        <!-- Secci√≥n de Login/Registro -->
        <div id="auth-section">
            <div class="share-section">
                <h3><i class="fas fa-share-alt"></i> Comparte este intercambio</h3>
                <p>Comparte este enlace con todos los participantes:</p>
                <div style="margin: 15px 0;">
                    <input type="text" id="share-link" value="" readonly style="width: 100%; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 5px;">
                    <button id="copy-link" class="share-btn link" style="margin-top: 10px;"><i class="fas fa-copy"></i> Copiar Enlace</button>
                </div>
                <div>
                    <button class="share-btn whatsapp" onclick="shareOnWhatsApp()"><i class="fab fa-whatsapp"></i> WhatsApp</button>
                    <button class="share-btn facebook" onclick="shareOnFacebook()"><i class="fab fa-facebook"></i> Facebook</button>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title"><i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n</h2>
                <div id="login-alert" class="alert hidden"></div>
                <div class="form-group">
                    <label for="login-email"><i class="fas fa-envelope"></i> Correo electr√≥nico</label>
                    <input type="email" id="login-email" placeholder="Tu correo electr√≥nico">
                </div>
                <div class="form-group">
                    <label for="login-password"><i class="fas fa-lock"></i> Contrase√±a</label>
                    <input type="password" id="login-password" placeholder="Tu contrase√±a">
                </div>
                <button id="login-btn" class="btn"><i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n</button>
                <p style="margin-top: 20px; text-align: center;">¬øNo tienes cuenta? <a href="#" id="show-register" style="color: var(--primary); font-weight: bold;">Reg√≠strate aqu√≠</a></p>
            </div>

            <div id="register-card" class="card hidden">
                <h2 class="card-title"><i class="fas fa-user-plus"></i> Registro de Participante</h2>
                <div id="register-alert" class="alert hidden"></div>
                <div class="form-group">
                    <label for="register-name"><i class="fas fa-user"></i> Nombre completo</label>
                    <input type="text" id="register-name" placeholder="Tu nombre completo">
                </div>
                <div class="form-group">
                    <label for="register-email"><i class="fas fa-envelope"></i> Correo electr√≥nico</label>
                    <input type="email" id="register-email" placeholder="Tu correo electr√≥nico">
                </div>
                <div class="form-group">
                    <label for="register-password"><i class="fas fa-lock"></i> Contrase√±a</label>
                    <input type="password" id="register-password" placeholder="Crea una contrase√±a">
                </div>
                <button id="register-btn" class="btn btn-secondary"><i class="fas fa-user-plus"></i> Registrarme</button>
                <p style="margin-top: 20px; text-align: center;">¬øYa tienes cuenta? <a href="#" id="show-login" style="color: var(--primary); font-weight: bold;">Inicia sesi√≥n aqu√≠</a></p>
            </div>
        </div>

        <!-- Secci√≥n Principal (visible despu√©s del login) -->
        <div id="main-section" class="hidden">
            <!-- Participantes -->
            <div id="participants-tab" class="tab-content">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-users"></i> Participantes del Intercambio</h2>
                    <p>Estas son las personas que participan en el intercambio. Presupuesto: <span class="budget">$300 MXN o m√°s</span></p>
                    <div id="participants-container" class="participants-container">
                        <!-- Los participantes se mostrar√°n aqu√≠ -->
                    </div>
                </div>
            </div>

            <!-- Preferencias -->
            <div id="preferences-tab" class="tab-content hidden">
                <div class="card preferences-form">
                    <h2 class="card-title"><i class="fas fa-heart"></i> Mis Preferencias de Regalo</h2>
                    <p>Comparte tus gustos e intereses para que tu pareja de intercambio tenga ideas para tu regalo.</p>
                    
                    <div class="form-group">
                        <label for="preference-category"><i class="fas fa-tags"></i> Categor√≠as que me gustan</label>
                        <select id="preference-category">
                            <option value="">Selecciona una categor√≠a</option>
                            <option value="Tecnolog√≠a">Tecnolog√≠a</option>
                            <option value="Ropa y Accesorios">Ropa y Accesorios</option>
                            <option value="Hogar y Decoraci√≥n">Hogar y Decoraci√≥n</option>
                            <option value="Libros">Libros</option>
                            <option value="Deportes">Deportes</option>
                            <option value="Videojuegos">Videojuegos</option>
                            <option value="Cosm√©ticos">Cosm√©ticos</option>
                            <option value="Joyer√≠a">Joyer√≠a</option>
                            <option value="Gourmet">Gourmet</option>
                            <option value="Otros">Otros</option>
                        </select>
                        <button id="add-category" class="btn" style="margin-top: 10px; padding: 10px 15px;"><i class="fas fa-plus"></i> Agregar Categor√≠a</button>
                        <div id="category-tags" class="preference-tags">
                            <!-- Las categor√≠as seleccionadas aparecer√°n aqu√≠ -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="preference-interests"><i class="fas fa-star"></i> Mis intereses y hobbies</label>
                        <textarea id="preference-interests" placeholder="Ejemplo: Me gusta leer novelas de misterio, hacer senderismo los fines de semana, y coleccionar tazas de caf√©..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="preference-size"><i class="fas fa-tshirt"></i> Talla (si aplica)</label>
                        <input type="text" id="preference-size" placeholder="Ejemplo: M, 28x32, 8.5 US">
                    </div>
                    
                    <div class="form-group">
                        <label for="preference-colors"><i class="fas fa-palette"></i> Colores favoritos</label>
                        <input type="text" id="preference-colors" placeholder="Ejemplo: Azul, negro, verde oscuro">
                    </div>
                    
                    <div class="form-group">
                        <label for="preference-allergies"><i class="fas fa-exclamation-triangle"></i> Alergias o restricciones</label>
                        <input type="text" id="preference-allergies" placeholder="Ejemplo: Alergia al chocolate, no uso productos de lana">
                    </div>
                    
                    <button id="save-preferences" class="btn btn-secondary"><i class="fas fa-save"></i> Guardar Preferencias</button>
                    <div id="preferences-alert" class="alert hidden" style="margin-top: 15px;"></div>
                </div>
            </div>

            <!-- Resultados -->
            <div id="result-tab" class="tab-content hidden">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-gift"></i> Tu Pareja de Intercambio</h2>
                    <div id="result-content" class="result-container">
                        <!-- El resultado se mostrar√° aqu√≠ -->
                    </div>
                </div>
            </div>

            <!-- Administraci√≥n -->
            <div id="admin-tab" class="tab-content hidden">
                <div class="card admin-section">
                    <h2 class="card-title"><i class="fas fa-crown"></i> Panel de Administraci√≥n</h2>
                    <p>Como administrador, puedes realizar el sorteo cuando todos est√©n registrados.</p>
                    <button id="draw-btn" class="btn btn-accent"><i class="fas fa-random"></i> Realizar Sorteo</button>
                    <div id="draw-alert" class="alert hidden" style="margin-top: 15px;"></div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">Informaci√≥n del Intercambio</h3>
                        <p><strong>Presupuesto:</strong> <span class="budget">$300 MXN o m√°s</span></p>
                        <p><strong>Fecha l√≠mite de registro:</strong> 15 de Diciembre</p>
                        <p><strong>Fecha del intercambio:</strong> 23 de Diciembre</p>
                        <p><strong>Participantes registrados:</strong> <span id="participant-count">0</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>Intercambio Navide√±o ¬© 2023 - ¬°Que la magia de la Navidad llene tu coraz√≥n de alegr√≠a!</p>
        </div>
    </footer>

    <script>
        // SOLUCI√ìN: Usar un ID √∫nico para este intercambio y almacenar datos en un servicio externo simulado
        // En un caso real, esto se conectar√≠a a una base de datos
        const EXCHANGE_ID = 'navidad2023_familia';
        
        // Datos almacenados en localStorage con ID √∫nico
        let users = JSON.parse(localStorage.getItem(`${EXCHANGE_ID}_users`)) || [];
        let assignments = JSON.parse(localStorage.getItem(`${EXCHANGE_ID}_assignments`)) || {};
        let preferences = JSON.parse(localStorage.getItem(`${EXCHANGE_ID}_preferences`)) || {};
        let currentUser = null;
        let isAdmin = false;

        // Elementos del DOM
        const authSection = document.getElementById('auth-section');
        const mainSection = document.getElementById('main-section');
        const mainNav = document.getElementById('main-nav');
        const shareLink = document.getElementById('share-link');
        
        const loginAlert = document.getElementById('login-alert');
        const registerAlert = document.getElementById('register-alert');
        const drawAlert = document.getElementById('draw-alert');
        const preferencesAlert = document.getElementById('preferences-alert');
        
        const participantsContainer = document.getElementById('participants-container');
        const resultContent = document.getElementById('result-content');
        const participantCount = document.getElementById('participant-count');
        
        const navTabs = document.querySelectorAll('.nav-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        const registerCard = document.getElementById('register-card');
        const showRegister = document.getElementById('show-register');
        const showLogin = document.getElementById('show-login');

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Establecer el enlace para compartir
            shareLink.value = window.location.href;
            
            // Verificar si hay un usuario logueado
            const savedUser = localStorage.getItem(`${EXCHANGE_ID}_currentUser`);
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainInterface();
            }

            // Event listeners
            document.getElementById('login-btn').addEventListener('click', login);
            document.getElementById('register-btn').addEventListener('click', register);
            document.getElementById('draw-btn').addEventListener('click', performDraw);
            document.getElementById('logout-btn').addEventListener('click', logout);
            document.getElementById('save-preferences').addEventListener('click', savePreferences);
            document.getElementById('add-category').addEventListener('click', addCategory);
            document.getElementById('copy-link').addEventListener('click', copyLink);
            
            // Navegaci√≥n por pesta√±as
            navTabs.forEach(tab => {
                if (tab.id !== 'logout-btn') {
                    tab.addEventListener('click', () => {
                        const tabId = tab.getAttribute('data-tab');
                        showTab(tabId);
                    });
                }
            });
            
            // Mostrar/ocultar formularios de login/registro
            showRegister.addEventListener('click', (e) => {
                e.preventDefault();
                registerCard.classList.remove('hidden');
            });
            
            showLogin.addEventListener('click', (e) => {
                e.preventDefault();
                registerCard.classList.add('hidden');
            });
            
            // Actualizar lista de participantes cada 3 segundos
            setInterval(updateParticipantsList, 3000);
            
            // Sincronizar datos entre pesta√±as
            window.addEventListener('storage', function(e) {
                if (e.key === `${EXCHANGE_ID}_users`) {
                    users = JSON.parse(e.newValue) || [];
                    updateParticipantsList();
                }
            });
        });

        // Copiar enlace al portapapeles
        function copyLink() {
            shareLink.select();
            document.execCommand('copy');
            showAlert(loginAlert, '¬°Enlace copiado al portapapeles!', 'success');
        }

        // Compartir en WhatsApp
        function shareOnWhatsApp() {
            const text = `¬°√önete a nuestro Intercambio Navide√±o! üéÑ\n\nPresupuesto: $300 MXN o m√°s\n\nEnlace: ${window.location.href}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        // Compartir en Facebook
        function shareOnFacebook() {
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}`, '_blank');
        }

        // Mostrar pesta√±a espec√≠fica
        function showTab(tabId) {
            navTabs.forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            tabContents.forEach(content => {
                if (content.id === `${tabId}-tab`) {
                    content.classList.remove('hidden');
                } else {
                    content.classList.add('hidden');
                }
            });
            
            // Cargar datos espec√≠ficos de la pesta√±a
            if (tabId === 'preferences') {
                loadPreferences();
            }
        }

        // Funci√≥n de login
        function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showAlert(loginAlert, 'Por favor, completa todos los campos', 'error');
                return;
            }
            
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem(`${EXCHANGE_ID}_currentUser`, JSON.stringify(user));
                showMainInterface();
                showAlert(loginAlert, '¬°Inicio de sesi√≥n exitoso!', 'success');
                
                // Limpiar formulario
                document.getElementById('login-email').value = '';
                document.getElementById('login-password').value = '';
            } else {
                showAlert(loginAlert, 'Credenciales incorrectas', 'error');
            }
        }

        // Funci√≥n de registro
        function register() {
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            
            if (!name || !email || !password) {
                showAlert(registerAlert, 'Por favor, completa todos los campos', 'error');
                return;
            }
            
            // Verificar si el usuario ya existe
            if (users.find(u => u.email === email)) {
                showAlert(registerAlert, 'Este correo ya est√° registrado', 'error');
                return;
            }
            
            // Crear nuevo usuario
            const newUser = {
                id: Date.now().toString(),
                name: name,
                email: email,
                password: password,
                avatar: getRandomAvatar(),
                registeredAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem(`${EXCHANGE_ID}_users`, JSON.stringify(users));
            
            // Disparar evento de storage para sincronizar entre pesta√±as
            window.dispatchEvent(new Event('storage'));
            
            showAlert(registerAlert, '¬°Registro exitoso! Ahora inicia sesi√≥n', 'success');
            
            // Limpiar formulario
            document.getElementById('register-name').value = '';
            document.getElementById('register-email').value = '';
            document.getElementById('register-password').value = '';
            
            // Mostrar formulario de login despu√©s de 2 segundos
            setTimeout(() => {
                registerCard.classList.add('hidden');
            }, 2000);
        }

        // Mostrar interfaz principal despu√©s del login
        function showMainInterface() {
            authSection.classList.add('hidden');
            mainSection.classList.remove('hidden');
            mainNav.style.display = 'block';
            
            // Verificar si es admin (primer usuario registrado)
            isAdmin = users.length > 0 && users[0].id === currentUser.id;
            
            // Mostrar/ocultar pesta√±a de admin
            const adminTab = document.getElementById('admin-tab');
            if (isAdmin) {
                adminTab.classList.remove('hidden');
            } else {
                adminTab.classList.add('hidden');
            }
            
            // Actualizar interfaz
            updateParticipantsList();
            
            // Verificar si ya se realiz√≥ el sorteo
            if (Object.keys(assignments).length > 0 && assignments[currentUser.id]) {
                showAssignmentResult();
            } else {
                resultContent.innerHTML = `
                    <div style="position: relative; z-index: 10;">
                        <h3>¬°Hola ${currentUser.name}!</h3>
                        <p>A√∫n no se ha realizado el sorteo del intercambio.</p>
                        <p>Vuelve m√°s tarde para descubrir a qui√©n te toca regalar.</p>
                        <p class="budget" style="margin-top: 20px;">Presupuesto: $300 MXN o m√°s</p>
                    </div>
                `;
            }
            
            // Mostrar pesta√±a de participantes por defecto
            showTab('participants');
        }

        // Cerrar sesi√≥n
        function logout() {
            currentUser = null;
            localStorage.removeItem(`${EXCHANGE_ID}_currentUser`);
            
            authSection.classList.remove('hidden');
            mainSection.classList.add('hidden');
            mainNav.style.display = 'none';
            
            // Mostrar mensaje de despedida
            showAlert(loginAlert, 'Has cerrado sesi√≥n correctamente', 'success');
        }

        // Actualizar lista de participantes
        function updateParticipantsList() {
            participantsContainer.innerHTML = '';
            participantCount.textContent = users.length;
            
            if (users.length === 0) {
                participantsContainer.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--text-light);">A√∫n no hay participantes registrados.</p>';
                return;
            }
            
            users.forEach(user => {
                const participantCard = document.createElement('div');
                participantCard.className = 'participant-card fade-in';
                
                // Verificar si el usuario tiene preferencias guardadas
                const userPreferences = preferences[user.id];
                const hasPreferences = userPreferences && (
                    userPreferences.categories.length > 0 || 
                    userPreferences.interests || 
                    userPreferences.colors
                );
                
                participantCard.innerHTML = `
                    <div class="participant-avatar">${user.avatar}</div>
                    <h3>${user.name}</h3>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 10px;">${user.email}</p>
                    ${hasPreferences ? '<div style="color: var(--success); font-size: 0.8rem;"><i class="fas fa-heart"></i> Preferencias guardadas</div>' : ''}
                    ${user.id === currentUser.id ? '<div style="color: var(--primary); font-size: 0.8rem; margin-top: 5px;"><i class="fas fa-user"></i> T√∫</div>' : ''}
                `;
                
                participantsContainer.appendChild(participantCard);
            });
        }

        // Realizar sorteo
        function performDraw() {
            if (users.length < 2) {
                showAlert(drawAlert, 'Se necesitan al menos 2 participantes para realizar el sorteo', 'error');
                return;
            }
            
            // Reiniciar asignaciones
            assignments = {};
            
            // Crear copia de la lista de usuarios para el sorteo
            let availableUsers = [...users];
            
            // Realizar asignaciones
            let success = true;
            
            users.forEach(user => {
                // Filtrar usuarios disponibles (excluyendo al usuario actual)
                const possibleAssignments = availableUsers.filter(u => u.id !== user.id);
                
                if (possibleAssignments.length === 0) {
                    // Si no hay opciones disponibles, hay un problema
                    success = false;
                    return;
                }
                
                // Seleccionar aleatoriamente
                const randomIndex = Math.floor(Math.random() * possibleAssignments.length);
                const assignedUser = possibleAssignments[randomIndex];
                
                // Asignar
                assignments[user.id] = assignedUser.id;
                
                // Eliminar el usuario asignado de la lista de disponibles
                availableUsers = availableUsers.filter(u => u.id !== assignedUser.id);
            });
            
            if (!success) {
                showAlert(drawAlert, 'Error en el sorteo. Int√©ntalo de nuevo.', 'error');
                return;
            }
            
            // Guardar asignaciones
            localStorage.setItem(`${EXCHANGE_ID}_assignments`, JSON.stringify(assignments));
            
            showAlert(drawAlert, '¬°Sorteo realizado con √©xito!', 'success');
            
            // Mostrar resultado
            showAssignmentResult();
            showTab('result');
        }

        // Mostrar resultado de la asignaci√≥n
        function showAssignmentResult() {
            if (assignments[currentUser.id]) {
                const assignedUserId = assignments[currentUser.id];
                const assignedUser = users.find(u => u.id === assignedUserId);
                const assignedPreferences = preferences[assignedUserId] || {};
                
                let preferencesHTML = '';
                if (assignedPreferences.categories && assignedPreferences.categories.length > 0) {
                    preferencesHTML += `<p><strong>Categor√≠as que le gustan:</strong> ${assignedPreferences.categories.join(', ')}</p>`;
                }
                if (assignedPreferences.interests) {
                    preferencesHTML += `<p><strong>Intereses:</strong> ${assignedPreferences.interests}</p>`;
                }
                if (assignedPreferences.colors) {
                    preferencesHTML += `<p><strong>Colores favoritos:</strong> ${assignedPreferences.colors}</p>`;
                }
                if (assignedPreferences.size) {
                    preferencesHTML += `<p><strong>Talla:</strong> ${assignedPreferences.size}</p>`;
                }
                if (assignedPreferences.allergies) {
                    preferencesHTML += `<p><strong>Alergias/restricciones:</strong> ${assignedPreferences.allergies}</p>`;
                }
                
                resultContent.innerHTML = `
                    <div style="position: relative; z-index: 10;">
                        <h3>¬°Felicitaciones ${currentUser.name}!</h3>
                        <p>En esta Navidad te ha tocado regalarle a:</p>
                        <div class="result-name">${assignedUser.name}</div>
                        <p><i class="fas fa-envelope"></i> ${assignedUser.email}</p>
                        <div class="budget">Presupuesto: $300 MXN o m√°s</div>
                        
                        ${preferencesHTML ? `
                        <div style="margin-top: 25px; text-align: left; background: rgba(255,255,255,0.7); padding: 15px; border-radius: 10px;">
                            <h4 style="color: var(--primary); margin-bottom: 10px;"><i class="fas fa-lightbulb"></i> Ideas para el regalo</h4>
                            ${preferencesHTML}
                        </div>
                        ` : '<p style="margin-top: 20px; font-style: italic;">Esta persona no ha compartido sus preferencias a√∫n.</p>'}
                        
                        <p style="margin-top: 25px;">üéÅ ¬°Prepara un regalo especial! üéÑ</p>
                        <p style="font-style: italic; margin-top: 15px; font-size: 0.9rem;">Recuerda guardar el secreto hasta el d√≠a del intercambio</p>
                    </div>
                `;
            }
        }

        // Cargar preferencias del usuario
        function loadPreferences() {
            const userPreferences = preferences[currentUser.id] || {
                categories: [],
                interests: '',
                size: '',
                colors: '',
                allergies: ''
            };
            
            document.getElementById('preference-interests').value = userPreferences.interests || '';
            document.getElementById('preference-size').value = userPreferences.size || '';
            document.getElementById('preference-colors').value = userPreferences.colors || '';
            document.getElementById('preference-allergies').value = userPreferences.allergies || '';
            
            // Cargar categor√≠as
            const categoryTags = document.getElementById('category-tags');
            categoryTags.innerHTML = '';
            
            if (userPreferences.categories) {
                userPreferences.categories.forEach(category => {
                    const tag = document.createElement('div');
                    tag.className = 'tag';
                    tag.innerHTML = `
                        ${category}
                        <i class="fas fa-times" data-category="${category}"></i>
                    `;
                    categoryTags.appendChild(tag);
                });
            }
            
            // Agregar event listeners para eliminar categor√≠as
            document.querySelectorAll('#category-tags .fa-times').forEach(icon => {
                icon.addEventListener('click', function() {
                    const categoryToRemove = this.getAttribute('data-category');
                    removeCategory(categoryToRemove);
                });
            });
        }

        // Agregar categor√≠a
        function addCategory() {
            const categorySelect = document.getElementById('preference-category');
            const selectedCategory = categorySelect.value;
            
            if (!selectedCategory) {
                showAlert(preferencesAlert, 'Por favor, selecciona una categor√≠a', 'error');
                return;
            }
            
            const userPreferences = preferences[currentUser.id] || { categories: [] };
            if (!userPreferences.categories) {
                userPreferences.categories = [];
            }
            
            // Evitar duplicados
            if (userPreferences.categories.includes(selectedCategory)) {
                showAlert(preferencesAlert, 'Esta categor√≠a ya est√° en tu lista', 'warning');
                return;
            }
            
            userPreferences.categories.push(selectedCategory);
            preferences[currentUser.id] = userPreferences;
            localStorage.setItem(`${EXCHANGE_ID}_preferences`, JSON.stringify(preferences));
            
            // Actualizar la visualizaci√≥n
            loadPreferences();
            showAlert(preferencesAlert, 'Categor√≠a agregada correctamente', 'success');
        }

        // Eliminar categor√≠a
        function removeCategory(category) {
            const userPreferences = preferences[currentUser.id];
            if (userPreferences && userPreferences.categories) {
                userPreferences.categories = userPreferences.categories.filter(c => c !== category);
                preferences[currentUser.id] = userPreferences;
                localStorage.setItem(`${EXCHANGE_ID}_preferences`, JSON.stringify(preferences));
                
                // Actualizar la visualizaci√≥n
                loadPreferences();
            }
        }

        // Guardar preferencias
        function savePreferences() {
            const interests = document.getElementById('preference-interests').value;
            const size = document.getElementById('preference-size').value;
            const colors = document.getElementById('preference-colors').value;
            const allergies = document.getElementById('preference-allergies').value;
            
            const userPreferences = preferences[currentUser.id] || { categories: [] };
            userPreferences.interests = interests;
            userPreferences.size = size;
            userPreferences.colors = colors;
            userPreferences.allergies = allergies;
            
            preferences[currentUser.id] = userPreferences;
            localStorage.setItem(`${EXCHANGE_ID}_preferences`, JSON.stringify(preferences));
            
            showAlert(preferencesAlert, 'Tus preferencias se han guardado correctamente', 'success');
        }

        // Mostrar alertas
        function showAlert(alertElement, message, type) {
            alertElement.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle'}"></i>
                <span>${message}</span>
            `;
            alertElement.className = `alert alert-${type}`;
            alertElement.classList.remove('hidden');
            
            // Ocultar alerta despu√©s de 5 segundos
            setTimeout(() => {
                alertElement.classList.add('hidden');
            }, 5000);
        }

        // Obtener avatar aleatorio
        function getRandomAvatar() {
            const avatars = ['üéÖ', 'ü§∂', 'üßë‚ÄçüéÑ', 'üë©‚ÄçüéÑ', 'ü¶å', '‚òÉÔ∏è', 'üéÑ', 'üéÅ', 'üîî', '‚≠ê'];
            return avatars[Math.floor(Math.random() * avatars.length)];
        }
    </script>
</body>
</html>
